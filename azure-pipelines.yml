stages:
- stage: publish
  jobs:
  ############################
  # Publish job
  ############################
  - job: publish
    displayName: 'Publish artifacts'
    steps:
    - task: PublishPipelineArtifact@0
      inputs:
        artifactName: a1
        targetPath: files/a1
      displayName: Publish pipeline artifact (a1)

    - task: PublishPipelineArtifact@0
      inputs:
        artifactName: a2
        targetPath: files/a2
      displayName: Publish pipeline artifact (a2)

    - task: PublishPipelineArtifact@0
      inputs:
        artifactName: a3
        targetPath: files/a3
      displayName: Publish pipeline artifact (a3)

    - task: PublishBuildArtifacts@1
      inputs:
        pathtoPublish: '$(Build.SourcesDirectory)/files/a1'
        ArtifactName: b1
      displayName: Publish build artifacts (b1)

    - task: PublishBuildArtifacts@1
      inputs:
        pathtoPublish: '$(Build.SourcesDirectory)/files/a2'
        ArtifactName: b2
      displayName: Publish build artifacts (b2)

    - task: PublishBuildArtifacts@1
      inputs:
        pathtoPublish: '$(Build.SourcesDirectory)/files/a3'
        ArtifactName: b3
      displayName: Publish build artifacts (b3)

- stage: download
  dependsOn: publish
  jobs:
  ############################
  # Download jobs
  ############################
  - template: download-job.yml
    parameters:
      id: test1
      artifactName: a1
      itemPattern: '**'

  - template: download-job.yml
    parameters:
      id: test2
      artifactName: a1
      itemPattern: 'a1/**'

  - template: download-job.yml
    parameters:
      id: test3
      artifactName: a1
      itemPattern: 'b2/**'

  - template: download-job.yml
    parameters:
      id: test4
      itemPattern: 'a1/**'

  - template: download-job.yml
    parameters:
      id: test5
      artifactName: a1
      itemPattern: 'a1/*'

  - template: download-job.yml
    parameters:
      id: test6
      artifactName: a1
      itemPattern: '*'

  - template: download-job.yml
    parameters:
      id: test7
      artifactName: a1
      itemPattern: '*/*'      

  - template: download-job.yml
    parameters:
      id: test8
      artifactName: a1
      itemPattern: 'a1/*.dll'

  - template: download-job.yml
    parameters:
      id: test9
      artifactName: a1
      itemPattern: 'a1/*.txt'

  - template: download-job.yml
    parameters:
      id: test10
      itemPattern: '**'

  - template: download-job.yml
    parameters:
      id: test11
      itemPattern: '**/*.txt'

  - template: download-job.yml
    parameters:
      id: test12
      itemPattern: 'a1/*.txt'

  - template: download-job.yml
    parameters:
      id: test13
      itemPattern: '*.txt' 

  - template: download-job.yml
    parameters:
      id: test14
      itemPattern: '*1/**'